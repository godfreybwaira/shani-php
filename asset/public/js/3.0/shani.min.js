(function(t){"use strict";t.addEventListener("DOMContentLoaded",function(){s.shanify(this.body),e.mutate(this.body)});const e=function(){const e=function(e){if(e.hasAttribute("src")){const n=null!==t.head.querySelector('script[src="'+e.src+'"]');n||(t.head.appendChild(e),e.addEventListener("load",function(){Function(this.textContent)()}))}else Function(e.textContent)()},n=function(t){if(t instanceof Element){if("SCRIPT"===t.tagName)return e(t);s.shanify(t)}},i=function(t){for(const e of t){let t=e.addedNodes;for(const e of t)n(e);t=e.removedNodes;for(const e of t)r.OBSERVERS.delete(e)}},o=function(t){for(const e of t)e.isIntersecting&&(e.target.dispatchEvent(new Event("demand")),this.disconnect())};return{mutate(t){new MutationObserver(i).observe(t,{subtree:!0,childList:!0})},intersect(t){new IntersectionObserver(o).observe(t)}}}(),n=function(){const e=function(t,e){const n=e.split(" ");if("replace"===n[0])return t.classList.replace(n[1],n[2]);for(let e=1;e<n.length;e++)t.classList[n[0]](n[e])},r=function(t,r,s){const i=n.explode(t.css);for(let n of i)n[0]!==r&&n[0]!==s||e(t.emitter,n[1])};return{dispatch(e,n){t.dispatchEvent(new CustomEvent("shani:"+e,{detail:this.object(n)}))},object:t=>Object.setPrototypeOf(t||{},null),fire(t,e){if(e.event=t,e.stcode="status"in e?e.status+"":null,r(e.req,t,e.stcode),e.req.plugin){const r=n.explode(e.req.plugin);for(const s of r)n.dispatch(s[0]+":"+t,e)}else n.dispatch(t,e)},getType:t=>t?t.substring(t.indexOf("/")+1).split(";")[0]:null,isInput:t=>["INPUT","TEXTAREA"].indexOf(t.tagName)>-1,explode(t,e){const n=new Map;if(t){const r=t.split(e||"|");for(let t of r){const e=t.indexOf(":"),r=e>0?t.substring(0,e):t;n.set(r.toLowerCase().trim(),e>0?t.substring(e+1).trim():null)}}return n}}}(),r=function(){const e=function(t,e){const n=t.getAttribute("shani-watch").split(",");for(let r of n)if(e.req.emitter.matches(r))return o.init(t,e)},s=function(t){for(const n of r.OBSERVERS)(n[1].has(t.detail.event)||n[1].has(t.detail.stcode))&&e(n[0],t.detail)},i=function(e,i){if(!e.hasAttribute(i))return;let o=e.getAttribute("watch-on");o||(o=e.hasAttribute("shani-fn")?"init":"data",e.setAttribute("watch-on",o)),o=n.explode(o);for(let e of o)t.addEventListener("shani:"+e[0],s);r.OBSERVERS.set(e,o)};return{OBSERVERS:new Map,watch(t,e){const n="shani-watch";if(e)return i(t,n);o.create(t,n,i)}}}(),s=function(){const i=function(t){const e=t.target.closest("[shani-on~="+t.type+"]");e&&(["A","AREA","FORM"].indexOf(e.tagName)>-1&&t.preventDefault(),o.init(e))},c=function(t){const e=t.querySelectorAll("[name]");for(let t=0;t<e.length&&0===e[t].id.length;t++)e[t].id=e[t].name},a=function(t,e){t.hasAttribute(e)&&("FORM"===t.tagName&&c(t),s.listen(t))};return{listen(r){let s=r.getAttribute("shani-on");if(s){s=n.explode(s);for(const n of s)"load"===n[0]?(r.addEventListener(n[0],i),r.dispatchEvent(new Event(n[0]))):"demand"===n[0]?(r.addEventListener(n[0],i),e.intersect(r)):t.addEventListener(n[0],i)}else s="FORM"===r.tagName?"submit":n.isInput(r)||"SELECT"===r.tagName?"change":"click",r.setAttribute("shani-on",s),t.addEventListener(s,i)},shanify(t,e){const n="shani-fn";e?a(t,n):o.create(t,n,a),r.watch(t,e)}}}(),i=function(){window.Shanify||(window.Shanify=function(e,n,r=!1){if("string"==typeof e&&(e=t.querySelectorAll(e)),!r)for(let t=0;t<e.length;t++)for(let r in n)e[t].setAttribute(r,n[r]);s.shanify(e,r)});const e=function(t,e,n,r){if("delete"===n)return t.remove();const s="insertAdjacent"+(r?"HTML":"Text");if("remove"===n)return t[s]("afterend",e),t.remove();t[s](n,e)},r=function(e,n,r){const s=t.createElement("a");s.href="data:"+r+","+encodeURI(e),s.setAttribute("download",n),t.body.appendChild(s),s.click(),s.remove()},i=function(t,e,r){let s=n.object({data:e,headers:r});if(t){const e=t.split("|");for(const t of e)s=n.object(new Function("return "+t)().call(s))}return s},o=function(t,e,n,r){if("replace"!==n)return!0;"html"===r?t.emitter.innerHTML=e:t.emitter.textContent=e},a=function(t,e,n){if("first"===n)t.emitter.value=e+t.emitter.value;else if("append"===n)t.emitter.value+=e;else{if("replace"!==n)return!0;t.emitter.value=e}},l=function(t,r,s){const i=n.object({before:"beforebegin",after:"afterend",remove:"remove",first:"afterbegin",last:"beforeend",delete:"delete",replace:"replace"})[t.insert];if(i){const c=n.isInput(t.emitter)?a(t,r,i):o(t,r,i,s);c&&e(t.emitter,r,i,"html"===s)}},u=function(t,e,n,s){if(t&&e.length>0){const i=t.substring(t.lastIndexOf(".")+1),o=["json","xml","yaml","csv"];if(i===s||o.indexOf(i)<0)return r(e,t,n);n=("json"===i?"application/":"text/")+i;const a=s+"2"+i;return r(c[a](e),t,n)}},f=function(t){return t>199&&t<300?"success":t>299&&t<400?"redirect":t>399&&t<500?"error":t<200?"info":"down"},d=function(t,e,n,r){for(const s of n)t[s]=e.getAttribute(r+s)};return{HTML_ATTR:["download","enctype","method"],SHANI_ATTR:["mw","target","header","plugin","poll","insert","css","fn"],init(t,e){t.url=e.getAttribute("href")||e.getAttribute("action")||e.value,d(t,e,this.SHANI_ATTR,"shani-"),d(t,e,this.HTML_ATTR,""),t.timer=n.object()},manage(t,e,r,s,o){const c=i(t.mw,r,e),a=c.headers.get("content-type"),d=n.getType(a),m={req:t,response:r,headers:e,status:s,text:o};n.fire(f(s),m),l(t,c.data,d),u(t.download,c.data,a,d),r.length>0&&n.fire("data",m)},plugins(t){const e=n.explode(t.plugin);for(const r of e)n.dispatch(r[0],{req:t,param:r[1]})}}}(),o=function(){const e=function(t,e){this.srcNode=e?e.req.emitter:null,this.detail=e,this.emitter=t,i.init(this,t),n.fire("init",{req:this})};e.prototype={r(){r(this,"GET")},w(){r(this,"POST")},print(){if(window.print instanceof Function){const t=o(this);window.print(),t.remove(),n.fire("print",{req:this})}},fs(){if(t.fullscreenEnabled){const e=this,r=o(this,35);t.documentElement.requestFullscreen().then(function(){t.addEventListener("fullscreenchange",function(){t.fullscreenElement||r.remove()}),n.fire("fullscreen",{req:e})}).catch(function(){r.remove()})}},copy(){const e=s(this);if(n.isInput(e))e.select(),t.execCommand("copy");else{const n=t.createElement("TEXTAREA");n.style.width=0,n.style.height=0,t.body.appendChild(n),n.value=e.innerText,n.select(),t.execCommand("copy"),n.remove()}n.fire("copy",{req:this,status:200})}};const r=function(t,e){let r=t.emitter;"FORM"===r.tagName&&(r=t.emitter.querySelector("fieldset")||r),r.style.opacity=.5,r.setAttribute("disabled","disabled"),a(t,t.method||e,function(e){r.removeAttribute("disabled"),r.style.opacity=null,n.fire("end",{req:t,status:100,text:e.statusText}),c(t)})},s=function(e){return e.target?t.querySelector(e.target):e.emitter},o=function(e,n){const r=t.createElement("div"),i=100+(n||0),o=t.createElement("div"),c="shn"+Date.now();r.setAttribute("id",c);let a="body>:not(#"+c+"){display:none}#"+c+"{position:fixed;top:0;left:0;width:100%;";return a+="height:100%;padding:1rem;overflow-y:auto;font-size:"+i+"%;background:#fff;z-index:999;}",r.innerHTML=s(e).outerHTML,r.insertBefore(o,r.firstChild),t.body.insertBefore(r,t.body.firstChild),o.innerHTML=a,r},c=function(t){t.timer.steps>-1&&(!t.timer.limit||--t.timer.limit>0)&&setTimeout(l,t.timer.steps,t)},l=function(t){if(i.plugins(t),t.detail&&!t.fn){const e=t.detail;return i.manage(t,e.headers,e.response,e.status,e.text)}t[t.fn]()};return{init(t,n){if(!t.hasAttribute("disabled")){const r=new e(t,n||null);if(r.poll){const t=r.poll.split(" ");r.timer.steps=1e3*Number(t[1]||-1),r.timer.limit=parseInt(t[2])||null,setTimeout(l,1e3*Number(t[0]||0),r)}else l(r)}},create(t,e,n){const r=t instanceof NodeList?t:t.querySelectorAll("["+e+"]");for(let t=0;t<r.length;t++)n(r[t],e)}}}(),c=function(){const t=function(t){if(t.length>0){if(/^null$/i.test(t))return null;if(/^(true|false)$/i.test(t))return"true"===t.toLowerCase();if(/^[-+]?\d+([Ee.]\d+)?$/.test(t))return Number(t)}return t},e=function(t){return"string"==typeof t?n.object(JSON.parse(t)):t};return{form2json(t){const e=n.object(),r=[];for(const n of t){if(r.indexOf(n[0])>-1)continue;r.push(n[0]);const s=t.getAll(n[0]),i=n[0].replace(/\[\]/g,"");if(s.length>1){e[i]=[];for(let t of s)e[i].push(t)}else e[i]=s[0]}return e},json2xml(t){const n=function(t,e){let r="<"+e+">";if("object"==typeof t){const s=t instanceof Array;for(let i in t)r+=n(t[i],s?e.replace(/[ ]+/,"-")+(1+parseInt(i)):i)}else r+=t;return r+"</"+e+">"};return'<?xml version="1.0"?>'+n(e(t),"data")},json2yaml(t){const n=function(t,e){let r="",s="";for(let t=0;t<e;t++)s+="  ";const i=t instanceof Array;for(let o in t){const c=s+(i?"-":o+":");"object"!=typeof t[o]?r+=c+" "+t[o]+"\r\n":r+=c+"\r\n"+n(t[o],e+1)}return r};return n(e(t),0).trim()},json2csv(t){const n=function(t){return'"'+(null!==t||void 0!==t?t instanceof Array?t.join("|"):t:"")+'"'};t=e(t);const r=t instanceof Array?t:[t];let s=Object.keys(r[0]).map(n).join(",");for(let t of r){const e=[];for(let r of t)e.push(n(r));s+="\r\n"+e.join(",")}return s},csv2json(t){let e;const r=t.trim().split("\r\n"),s=[];for(let t in r){const i=r[t].substring(1,r[t].lastIndexOf('"')).split(/"\s*,\s*"/);if(t>0){const t=n.object();for(let n in i)t[e[n].trim()]=i[n];s.push(t)}else e=i}return s},xml2json(e){const r=e.substring(e.indexOf("?>")+2),s=r.match(/(\<[^<>]+\>[^<]+|\<[^<>]+\>)/g),i=function(t){return t.match(/[^<> /]+/g)[0]},o=function(t){return"/"===t.trim()[1]},c=function(t){const e=t.trim(),n=e.substring(0,e.indexOf(">"));return"/"===n[n.length-1]},a=function(t,e){if(c(t[e]))return[];let n=0;const r=[],s=i(t[e]);for(;++e<t.length&&(c(t[e])||(n+=o(t[e])?-1:1),!(n<0&&i(t[e])===s));)r.push(t[e]);return r},l=function(e){return c(e)?null:t(e.substring(e.indexOf(">")+1))},u=function(t,e,n){e in t?(t[e]instanceof Array||(t[e]=[t[e]]),t[e].push(n)):t[e]=n},f=function(t){const e=n.object();for(let n=0;n<t.length;n++)if(!o(t[n])){const r=a(t,n),s=i(t[n]),o=r.length>0?f(r):l(t[n]);n+=r.length,u(e,s,o)}return e};return f(s)},yaml2json(t){},csv2xml(t){return this.json2xml(this.csv2json(t))},csv2yaml(t){return this.json2yaml(this.csv2json(t))},xml2yaml(t){return this.json2yaml(this.xml2json(t))},xml2csv(t){return this.json2csv(this.xml2json(t))},yaml2csv(t){return this.json2csv(this.yaml2json(t))},yaml2xml(t){return this.json2xml(this.yaml2json(t))},urlencoded(t){const e=[];let n="";for(const r of t){if(e.indexOf(r[0])>-1)continue;const s=t.getAll(r[0]);for(let t of s)n+="&"+r[0]+"="+encodeURIComponent(t);e.push(r[0])}return n.substr(1)},formDataTo(t,e){switch(e){case"json":return JSON.stringify(this.form2json(t));case"xml":return this.json2xml(this.form2json(t));case"yaml":return this.json2yaml(this.form2json(t));case"csv":return this.json2csv(this.form2json(t));case"x-www-form-urlencoded":return this.urlencoded(t)}return t}}}(),a=function(){const t=function(t,e){if(t.url=e.get("location"),e.get("x-ajax")){for(const n of e){if(i.HTML_ATTR.indexOf(n[0])>-1){t[n[0]]=n[1];continue}const e=n[0].substring(n[0].lastIndexOf("-")+1);i.SHANI_ATTR.indexOf(e)>-1&&(t[e]=n[1])}return t.fn=t.fn||"r",t[t.fn]()}"#"===t.url?history.go(0):window.location=t.url},e=function(e,r,s){const o=r.statusText,c=function(t,e){return r.addEventListener(t,e),c};c("readystatechange",function(){if(4===this.readyState){n.fire("ready",{req:e,status:r.status,text:r.statusText});const s=n.explode(r.getAllResponseHeaders(),"\r\n");if(r.status<300||r.status>399)return i.manage(e,s,r.response,r.status,r.statusText);t(e,s)}})("abort",function(t){n.fire(t.type,{req:e,status:410,text:o})})("error",function(t){e.timer.limit>0&&e.timer.limit++,n.fire(t.type,{req:e,status:410,text:o})})("timeout",function(t){n.fire(t.type,{req:e,status:408,text:o})})("loadstart",function(t){n.fire(t.type,{req:e,status:102,text:o})})("loadend",function(){s(this)}),r.upload.addEventListener("progress",function(t){t.lengthComputable&&n.fire(t.type,{req:e,status:102,text:o,bytes:{loaded:t.loaded,total:t.total}})})},r=function(t){const e=n.getType(t.enctype),r=n.explode(t.header);return e&&"form-data"!==e&&r.set("content-type",t.enctype.trim()),r},s=function(t){const e=t.getAttribute("name"),n=new FormData;if(t.files)for(let r=0;r<t.files.length;r++)n.append(e||"file[]",t.files[r]);else n.append(e||"value",t.value);return n},o=function(t,e){let i=null;["SELECT","INPUT","TEXTAREA"].indexOf(t.emitter.tagName)>-1?i=s(t.emitter):"FORM"===t.emitter.tagName&&(i=new FormData(t.emitter));const o=n.object({url:t.url,data:null,headers:r(t)});if(i)if("GET"===e.toUpperCase()){const e=t.url.indexOf("?")<0?"?":"&";o.url=t.url+e+c.urlencoded(i)}else{const t=n.getType(o.headers.get("content-type"));o.data=c.formDataTo(i,t)}return o};return function(t,n,r){const s=o(t,n),i=new XMLHttpRequest;i.open(n,s.url,!0);for(const t of s.headers)i.setRequestHeader(t[0],t[1]);e(t,i,r),i.withCredentials=!0,i.send(s.data)}}()})(document);